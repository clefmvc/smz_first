(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ffc0137c"],{"149b":function(e,r,t){"use strict";t("eb50")},"48c3":function(e,r,t){},"5dc0":function(e,r,t){"use strict";t.r(r);var s=function(){var e=this,r=e._self._c;return r("div",{staticClass:"page_account register",attrs:{id:"account_register"}},[r("div",{staticClass:"warp register_warp"},[r("div",{staticClass:"container"},[r("div",{staticClass:"row row_registers"},[e._m(0),r("div",{staticClass:"form_register"},[r("div",{staticClass:"form_box"},[r("b-form",{staticClass:"forms"},[r("div",{staticClass:"diy_forms"},[r("b-form-group",{attrs:{id:"input-group-1",label:"账号:","label-for":"input-1"}},[r("b-form-input",{attrs:{id:"input-1",type:"text",placeholder:"请输入账号",trim:""},model:{value:e.form.username,callback:function(r){e.$set(e.form,"username",r)},expression:"form.username"}})],1),r("b-form-group",{attrs:{id:"input-group-2",label:"设置密码:","label-for":"input-2"}},[r("b-form-input",{attrs:{id:"input-2",type:"password",placeholder:"5个字符到16个字符",trim:""},model:{value:e.form.password,callback:function(r){e.$set(e.form,"password",r)},expression:"form.password"}})],1),r("b-form-group",{attrs:{id:"input-group-3",label:"确认密码:","label-for":"input-3"}},[r("b-form-input",{attrs:{id:"input-3",type:"password",placeholder:"请再次输入密码",trim:""},model:{value:e.confirm_password,callback:function(r){e.confirm_password=r},expression:"confirm_password"}})],1),r("b-form-group",{attrs:{id:"input-group-4",label:"昵称:","label-for":"input-4"}},[r("b-form-input",{attrs:{id:"input-4",type:"text",placeholder:"2个字符到12个字符",trim:""},model:{value:e.form.nickname,callback:function(r){e.$set(e.form,"nickname",r)},expression:"form.nickname"}})],1),r("b-form-group",{attrs:{id:"input-group-5",label:"邮箱:","label-for":"input-5"}},[r("b-form-input",{attrs:{id:"input-5",type:"email",placeholder:"例: example@123.com",trim:""},model:{value:e.form.email,callback:function(r){e.$set(e.form,"email",r)},expression:"form.email"}})],1),r("b-form-group",{attrs:{id:"input-group-7",label:"身份:","label-for":"input-7"}},[r("b-form-select",{attrs:{id:"user_group",options:e.list_user_group,placeholder:"请选择身份"},model:{value:e.form.user_group,callback:function(r){e.$set(e.form,"user_group",r)},expression:"form.user_group"}})],1)],1),"普通用户"===e.form.user_group?r("form_ordinary_user",{attrs:{form:e.form_sub}}):e._e()],1),r("div",{staticClass:"btns_bottom rs_bt"},[r("button",{staticClass:"btn_item btn",on:{click:function(r){return e.submit()}}},[r("span",[e._v("注册")])]),r("button",{staticClass:"forgot_nav btn",on:{click:function(r){return e.$router.push("/account/forgot")}}},[r("span",[e._v("找回密码")])]),r("button",{staticClass:"login_bt btn",on:{click:function(r){return e.$router.push("/account/login")}}},[e._v("是否已经拥有一个账户？"),r("span",[e._v("去登录")])])])],1)]),e._m(1)])])])])},o=[function(){var e=this,r=e._self._c;return r("div",{staticClass:"t-box"},[r("span"),r("span")])},function(){var e=this,r=e._self._c;return r("div",{staticClass:"b-box"},[r("span"),r("span")])}],a=t("c6e7"),i=function(){var e=this,r=e._self._c;return r("div",{staticClass:"diy_form"},[e.$check_register_field("add","user_name","/ordinary_user/view")?r("b-form-group",{attrs:{id:"user_name",label:"用户姓名","label-for":"user_name"}},[r("b-form-input",{attrs:{id:"user_name",type:"text",placeholder:"请输入用户姓名",trim:""},model:{value:e.form["user_name"],callback:function(r){e.$set(e.form,"user_name",r)},expression:"form['user_name']"}})],1):e._e(),e.$check_register_field("add","user_phone","/ordinary_user/view")?r("b-form-group",{attrs:{id:"user_phone",label:"用户电话","label-for":"user_phone"}},[r("b-form-input",{attrs:{id:"user_phone",type:"text",placeholder:"请输入用户电话",trim:""},model:{value:e.form["user_phone"],callback:function(r){e.$set(e.form,"user_phone",r)},expression:"form['user_phone']"}})],1):e._e(),e.$check_register_field("add","user_gender","/ordinary_user/view")?r("b-form-group",{attrs:{id:"user_gender",label:"用户性别","label-for":"user_gender"}},[r("b-form-select",{attrs:{id:"user_gender",options:e.getDropList(e.list_user_gender)},model:{value:e.form["user_gender"],callback:function(r){e.$set(e.form,"user_gender",r)},expression:"form['user_gender']"}})],1):e._e()],1)},u=[],n=t("6265"),l={mixins:[n["a"]],model:{prop:"form",event:"change"},props:{form:{type:Object,default:()=>({})}},data(){return{url_upload:"~/api/ordinary_user/upload?",list_user_gender:"男,女"}},methods:{getDropList(e){let r=[];if(e){let t=e.split(",");t.forEach(e=>{r.push({value:e,text:e})})}return r},uploadFile(e,r="img"){var t=this,s=new FormData;s.append("file",e[0]),this.$upload(this.url_upload,s,(function(e){e.result?(t.$delete(t.form,r),t.$set(t.form,r,e.result.url),console.log(t.form[r])):t.$toast("上传失败！")}))},uploadFileMultiple(e,r="img"){var t=this,s=new FormData;s.delete("file");for(var o=0;o<e.length;o++)s.append("file",e[o]),this.$upload(this.url_upload,s,(function(e){e.result?r in t.form?t.form[r].push(e.result.url):t.$set(t.form,r,[e.result.url]):t.$toast("上传失败！")})),s.delete("file")},delImg(e,r="img"){var t=this;t.form[r].splice(e,1)}},created(){},mounted(){}},m=l,p=(t("c03f"),t("0b56")),c=Object(p["a"])(m,i,u,!1,null,null,null),f=c.exports,_={components:{form_ordinary_user:f},mixins:[a["a"]],data(){return{url_submit:"~/api/user/register?",form:{username:"",password:"",nickname:"",email:"",user_group:"",avatar:""},confirm_password:"",form_sub:{},list_user_group:[],user_group:[]}},methods:{get_list_user_group(){this.$get("~/api/user_group/get_list?register_max=3&register_min=2",{},e=>{if(e.result.list){var r=[],t=e.result.list;t.map(e=>{r.push({value:e.name,text:e.name})}),this.list_user_group=r,this.user_group=t}else e.error&&(console.error(e.error),this.$toast(e.error.message,"error"))})},async submit(e,r){e||(e=this.form),e.avatar=""==e.avatar?"/api/upload/default_avatar.jpg":e.avatar;var t,s=this.events("submit_before",Object.assign({},e))||e,o=await this.events("submit_check",s);return console.log("提交前错误信息msg：",o),o?this.$toast(o,"danger"):t=this.events("submit_main",s,r),t},submit_before(e){e.user_group},async submit_check(e){var r=null,t=/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,{username:s,password:o,nickname:a,user_group:i,email:u}=e,n=this.confirm_password;if(console.log("表单校验username ,password ,email ,nickname ,user_group",s,o,u,a,i),s?s.length>16||s.length<5?r="账号长度应为5到16个字符之间！":o?o.length>16||o.length<5?r="密码长度应为5到16个字符之间！":a&&a.length>12||a.length<2?r="昵称长度应为2个字符到12个字符之间":u&&!t.test(u)?r="请输入正确的邮箱地址 例：test@test.com!":o!=n?r="确认密码与密码不一致！":i||(r="请选择用户组!"):r="密码不能为空!":r="账号不能为空",!r&&i&&"普通用户"===i)Object.assign({},this.form_sub);var l={username:e.username};if(!r){var m=await this.$get("~/api/user/count?",l);m.result&&(r="用户已存在!")}return r},submit_after(e,r){var t=Object.assign({},this.form);delete t.password,console.log("查询表单form",t);var s=this.user_group.getVal("source_table",{name:t.user_group});console.log("关联表:",s),s?this.get_submit(t,s):console.log("用户组没有关联表")},get_submit(e,r){var t=this.form_sub;this.$get("~/api/user/get_obj?",e,e=>{console.log("注册表信息res",e),e.result&&e.result.obj?(t.user_id=e.result.obj.user_id,this.submit_sub(t,r)):e.error&&(console.error(e.error),this.$toast(e.error.message,"error"))})},submit_sub(e,r){for(var t in e)try{var s=e[t];console.log("键 ,值 ,类型",t,s,s instanceof Date),s&&s instanceof Date&&(e[t]=this.$toTime(s,"yyyy-MM-dd hh:mm:ss"))}catch(o){console.log(t,"转日期错误：",o,"收到请无视!")}this.$post("~/api/"+r+"/add?",e,e=>{console.log("提交结果res：",e),e.result?(this.$toast("注册成功!","success"),this.$router.push("/")):e.error&&(console.error(e.error),this.$toast(e.error.message))})}},created(){this.get_list_user_group()}},d=_,g=(t("149b"),Object(p["a"])(d,s,o,!1,null,"6bfc888e",null));r["default"]=g.exports},c03f:function(e,r,t){"use strict";t("48c3")},eb50:function(e,r,t){}}]);